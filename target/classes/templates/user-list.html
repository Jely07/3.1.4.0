<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin panel</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous"
    />
    <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"
    ></script>


    <script src="https://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<body>
<nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Fixed top</a>
        <ul class="nav justify-content-end">
            <a class="nav-link active" aria-current="page" th:href="@{/logout}"
            >Logout</a
            >
        </ul>
    </div>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col-2">
            <div class="d-grid gap-2">
                <button class="btn btn-primary" type="button">Admin</button>
                <button class="btn btn-primary" type="button">User</button>
            </div>
        </div>
        <div class="col-10">
            <h2>Admin panel</h2>
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <button
                            class="nav-link active"
                            id="nav-home-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#nav-home"
                            type="button"
                            role="tab"
                            aria-controls="nav-home"
                            aria-selected="true"
                    >
                        Users table
                    </button>
                    <button
                            class="nav-link"
                            id="nav-profile-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#nav-profile"
                            type="button"
                            role="tab"
                            aria-controls="nav-profile"
                            aria-selected="false"
                    >
                        New user
                    </button>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div
                        class="tab-pane fade show active"
                        id="nav-home"
                        role="tabpanel"
                        aria-labelledby="nav-home-tab"
                >
                    <div>All users</div>
                    <table class="table table-hover">
                        <tr>
                            <th>id</th>
                            <th>name</th>
                            <th>surname</th>
                            <th>password</th>
                            <th>salary</th>
                            <th>roles</th>
                            <th>edit</th>
                            <th>delete</th>
                        </tr>
                        <tr th:each="user : ${users}">
                            <td th:utext="${user.id}">id</td>
                            <td th:utext="${user.username}">Username</td>
                            <td th:utext="${user.surname}">Surname</td>
                            <td th:utext="${user.password}">Password</td>
                            <td th:utext="${user.salary}">Salary</td>
                            <td th:utext="${user.roles}">Roles</td>
                            <td>
                                <button type="button" class="btn btn-primary eBtn" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal"
                                        th:href="@{user-update/{id}(id=${user.id})}">
                                    Edit </button>
                            </td>
                            <td>
                                <a
                                        th:href="@{/user-delete/{id}(id=${user.id})}"
                                        target="_blank"
                                        class="btn btn-danger btn-sm"
                                >Delete</a
                                >
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="myForm" >
                    <form id="formEdit" th:action="@{/user-update}"  th:method="post">
                        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">5
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Edit user</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="mb-3">
                                            <label for="id" class="col-form-label">ID:</label>
                                            <input type="text" class="form-control" id="id" name="id" value=""/>
                                        </div>
                                        <div class="mb-3">
                                            <label for="username" class="col-form-label">username:</label>
                                            <input type="text" class="form-control" id="username" name="username" value=""/>
                                        </div>
                                        <div class="mb-3">
                                            <label for="surname" class="col-form-label">surname:</label>
                                            <input type="text" class="form-control" id="surname" name="surname" value=""/>
                                        </div>
                                        <div class="mb-3">
                                            <label for="password" class="col-form-label">password:</label>
                                            <input type="text" class="form-control" id="password" name="password" value=""/>
                                        </div>
                                            <div class="mb-3">
                                                <label for="salary" class="col-form-label">salary:</label>
                                                <input type="number" class="form-control" id="salary" name="salary" value=""/>
                                            </div>
                                        <div class="mb-3">
                                            <label for="roles" class="col-form-label">roles:</label>
                                            <th:block th:each="role: ${roles}">
                                                <input type="checkbox" th:field="*{roles}" id="roles"
                                                       th:text="${role.name}"  th:value="${role.id}" class="m-2" />
                                            </th:block>
<!--                                            <input type="text" class="form-control" id="roles" name="roles" value=""/>-->
                                        </div>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <input type="submit" class="btn btn-primary" value="save"/>
                                    </div>
                                    </div>
                                </div>
                            </div>
                    </form>
                </div>
                <div
                        class="tab-pane fade"
                        id="nav-profile"
                        role="tabpanel"
                        aria-labelledby="nav-profile-tab"
                >
                    <div>Add new user</div>
                    <form th:method="POST" th:action="@{/users}" th:object="${user}">

                        <label for="username">UserName:</label>
                        <input type="text" th:field="*{username}" id="usernameNew"/>
                        <br>
                        <label for="surname">Surname:</label>
                        <input type="text" th:field="*{surname}" id="surnameNew"/>
                        <br>
                        <label for="password">Password:</label>
                        <input type="text" th:field="*{password}" id="passwordNew"/>
                        <br>
                        <label for="salaryNew">Salary:</label>
                        <input type="text" th:field="*{salary}" id="salaryNew"/>
                        <br>
                        <th:block th:each="role: ${roles}">
                            <input type="checkbox" th:field="*{roles}"
                                   th:text="${role.name}" th:value="${role.id}" class="m-2" />
                        </th:block>
                        <input type="submit" value="Create!"/>
                    </form>
                </div>

        </div>
    </div>
</div>
</div>
<script>
    $(document).ready(function () {

                $('.eBtn').on('click', function (event) {
            event.preventDefault();
            console.log('start')
            const href = $(this).attr('href');
            console.log(href)
            $.get(href,function (user) {
                $('.modal-body #id').val(user.id);
                $('.modal-body #username').val(user.username);
                $('.modal-body #surname').val(user.surname);
                $('.modal-body #password').val(user.password);
                $('.modal-body #salary').val(user.salary);
                $('.modal-body #roles').val(user.role);
            });
        });
    });
    // const exampleModal = document.getElementById('exampleModal')
    // if (exampleModal) {
    //     console.log('start')
    //     exampleModal.addEventListener('show.bs.modal', event => {
    //         event.preventDefault();
    //         const button = event.relatedTarget
    //         const recipient = button.getAttribute('data-bs-whatever')
    //         const modalBodyInput = exampleModal.querySelector('.modal-body')
    //                 console.log(recipient)
    //                 $.get(recipient,function (user) {
    //                     modalBodyInput.username.val(user.username);
    //                     modalBodyInput.surname.val(user.surname);
    //                     modalBodyInput.password.val(user.password);
    //                     modalBodyInput.salary.val(user.salary);
    //                     modalBodyInput.roles.val(user.roles)
    //                     console.log('end')
    //                 })
    //         let modal = $(this)
    //         modal.find('.modal-title').text('New message to ' + recipient)
    //         modal.find('.modal-body input #username').val('Bella')

    //                 //     $.get(recipient,function (user) {
    //                 //         $(modalBodyInput.id).val(user.id);
    //                 //         $(modalBodyInput.username).val(user.username);
    //                 //         $(modalBodyInput.surname).val(user.surname);
    //                 //         $(modalBodyInput.password).val(user.password);
    //                 //         $(modalBodyInput.salary).val(user.salary);
    //                 //         $(modalBodyInput.roles).val(user.roles);
    //                 //     });
    //     })
    // }

    // $('#exampleModal').on('show.bs.modal', function (event) {
    //     let button = $(event.relatedTarget) // Кнопка, запускающая модальное окно
    //     let recipient = button.data('whatever') // Извлечь информацию из атрибутов data- *
    //     // При необходимости Вы можете инициировать здесь запрос AJAX (а затем выполнить обновление в обратном вызове).
    //     // Обновите содержимое модального окна. Здесь мы будем использовать jQuery, но вместо этого Вы можете использовать библиотеку привязки данных или другие методы.
    //     let modal = $(this)
    //     modal.find('.modal-title').text('New message to ' + recipient)
    //     modal.find('.modal-body input #username').val('Bella')
    // })
</script>
</body>
</html>
